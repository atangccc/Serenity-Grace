/**
 * Theme: theme-Serenity
 * Author: Serenity
 * Build: 2026-02-21 13:40:33
 * Fingerprint: a60e55b473a87906
 * Copyright Â© 2026 Serenity. All rights reserved.
 * Unauthorized copying or distribution is prohibited.
 */
(function(){'use strict';var CONTAINER_ID='pjax-container';var PJAX_CSS_ATTR='data-pjax-css';var PJAX_JS_ATTR='data-pjax-js';var GLOBAL_CSS=['base.css','lenis.css','aos.css','swiper-bundle.min.css','welcome.css','APlayer.min.css','music-panel.css','qweather-icons.css'];var GLOBAL_JS=['main.js','pjax.js','search.js','sidebar-sticky.js','welcome.js','lenis.min.js','swiper-bundle.min.js','aos.js','APlayer.min.js','Meting2.min.js','marked.min.js','medium-zoom.min.js'];var isNavigating=false;var _pjaxGeneration=0;var _pageTimers=[];var _origSetInterval=window.setInterval;var _origSetTimeout=window.setTimeout;var _origClearInterval=window.clearInterval;var _origClearTimeout=window.clearTimeout;function startTimerTracking(){_pageTimers=[];window.setInterval=function(){var id=_origSetInterval.apply(window,arguments);_pageTimers.push({type:'interval',id:id});return id;};window.setTimeout=function(){var id=_origSetTimeout.apply(window,arguments);_pageTimers.push({type:'timeout',id:id});return id;};}function stopTimerTracking(){window.setInterval=_origSetInterval;window.setTimeout=_origSetTimeout;}function clearPageTimers(){_pageTimers.forEach(function(t){if(t.type==='interval')_origClearInterval(t.id);else _origClearTimeout(t.id);});_pageTimers=[];}function isLocalLink(a){if(!a||!a.href)return false;if(a.target==='_blank')return false;if(a.hasAttribute('download'))return false;var href=a.getAttribute('href');if(!href||href.charAt(0)==='#')return false;if(a.href.indexOf('javascript:')===0)return false;if(a.href.indexOf('mailto:')===0)return false;var path=a.pathname||'';if(path.indexOf('/console')===0||path.indexOf('/login')===0)return false;return a.origin===window.location.origin;}function getFilename(url){return url.split('/').pop().split('?')[0].split('#')[0];}function isGlobalCSS(href){var name=getFilename(href);for(var i=0;i<GLOBAL_CSS.length;i++){if(name===GLOBAL_CSS[i])return true;}return false;}function isGlobalJS(src){var name=getFilename(src);for(var i=0;i<GLOBAL_JS.length;i++){if(name===GLOBAL_JS[i])return true;}return false;}function isThemeAsset(url){if(url.indexOf('/themes/theme-Serenity/')>-1)return true;if(url.indexOf('/assets/css/')===0||url.indexOf('/assets/js/')===0||url.indexOf('/assets/fonts/')===0)return true;return false;}function cleanupOldAssets(currentGen){document.querySelectorAll('link['+PJAX_CSS_ATTR+']').forEach(function(el){if(el.getAttribute(PJAX_CSS_ATTR)!==String(currentGen)){el.remove();}});document.querySelectorAll('script['+PJAX_JS_ATTR+']').forEach(function(el){if(el.getAttribute(PJAX_JS_ATTR)!==String(currentGen)){el.remove();}});}function extractPageCSS(doc){var links=[];doc.querySelectorAll('head link[rel="stylesheet"]').forEach(function(link){var href=link.getAttribute('href');if(href&&!isGlobalCSS(href)&&isThemeAsset(href)){links.push(href);}});return links;}function extractPageJS(doc){var scripts=[];doc.querySelectorAll('head script[src]').forEach(function(s){var src=s.getAttribute('src');if(src&&!isGlobalJS(src)&&isThemeAsset(src)){scripts.push(src);}});return scripts;}function extractHeadInlineScripts(doc){var inlines=[];doc.querySelectorAll('head script:not([src])').forEach(function(s){var text=s.textContent||'';if(text.indexOf('color-scheme')>-1)return;if(text.indexOf('@context')>-1)return;if(text.indexOf('welcome-init-style')>-1)return;if(text.indexOf('import ')>-1||text.indexOf('import{')>-1)return;if(text.indexOf('window.')>-1||text.indexOf('var ')===0){inlines.push(text);}});return inlines;}function injectCSS(hrefs,gen){var genStr=String(gen);var promises=[];hrefs.forEach(function(href){var existing=document.querySelector('link['+PJAX_CSS_ATTR+'][href="'+href+'"]');if(existing){existing.setAttribute(PJAX_CSS_ATTR,genStr);return;}var link=document.createElement('link');link.rel='stylesheet';link.href=href;link.setAttribute(PJAX_CSS_ATTR,genStr);promises.push(new Promise(function(resolve){link.onload=resolve;link.onerror=resolve;}));document.head.appendChild(link);});return promises.length>0?Promise.all(promises):Promise.resolve();}function injectJS(srcs,inlines){return new Promise(function(resolve){inlines.forEach(function(code){try{new Function(code)();}catch(e){console.warn('[PJAX] inline script error:',e);}});if(srcs.length===0){resolve();return;}var origAdd=document.addEventListener;document.addEventListener=function(type,fn,opts){if(type==='DOMContentLoaded'){_origSetTimeout(fn,0);return;}return origAdd.call(document,type,fn,opts);};startTimerTracking();var pending=srcs.length;srcs.forEach(function(src){var script=document.createElement('script');script.src=src+(src.indexOf('?')>-1?'&':'?')+'_pjax='+Date.now();script.setAttribute(PJAX_JS_ATTR,'');script.onload=script.onerror=function(){pending--;if(pending<=0){document.addEventListener=origAdd;stopTimerTracking();resolve();}};document.body.appendChild(script);});});}function reinitPage(){if(typeof clearPageScrollListeners==='function')clearPageScrollListeners();if(typeof AOS !=='undefined'){AOS.refreshHard();}if(window.__lenis){window.__lenis.scrollTo(0,{immediate:true});}else{window.scrollTo(0,0);}if(typeof initListScrollPassthrough==='function')initListScrollPassthrough();if(typeof initSmoothScroll==='function')initSmoothScroll();if(typeof initMemoSlider==='function')initMemoSlider();if(typeof initDragScroll==='function')initDragScroll();if(typeof initHeroBackground==='function')initHeroBackground();if(typeof initTypewriter==='function')initTypewriter();if(typeof cleanLifeDescriptions==='function')cleanLifeDescriptions();if(typeof sortStreamFeed==='function')sortStreamFeed();if(typeof initMobileDropdowns==='function')initMobileDropdowns();if(typeof initBackToTop==='function')initBackToTop();if(typeof initSidebarSticky==='function')initSidebarSticky();document.dispatchEvent(new Event('pjax:complete'));}function showTransition(){var el=document.getElementById('page-transition');if(el)el.classList.add('active');}function hideTransition(){var el=document.getElementById('page-transition');if(el)el.classList.remove('active');}function navigate(url,isPop){if(isNavigating)return;isNavigating=true;showTransition();var xhr=new XMLHttpRequest();xhr.open('GET',url,true);xhr.setRequestHeader('X-PJAX','true');xhr.timeout=8000;xhr.onload=function(){if(xhr.status>=200&&xhr.status<300){try{var parser=new DOMParser();var doc=parser.parseFromString(xhr.responseText,'text/html');var newContainer=doc.getElementById(CONTAINER_ID);if(!newContainer){window.location.href=url;return;}var cssHrefs=extractPageCSS(doc);var jsSrcs=extractPageJS(doc);var inlineScripts=extractHeadInlineScripts(doc);clearPageTimers();_pjaxGeneration++;var currentGen=_pjaxGeneration;injectCSS(cssHrefs,currentGen).then(function(){if(currentGen !==_pjaxGeneration)return;var container=document.getElementById(CONTAINER_ID);container.innerHTML=newContainer.innerHTML;cleanupOldAssets(currentGen);container.querySelectorAll('script').forEach(function(oldScript){var newScript=document.createElement('script');Array.from(oldScript.attributes).forEach(function(attr){newScript.setAttribute(attr.name,attr.value);});if(oldScript.textContent){newScript.textContent=oldScript.textContent;}oldScript.parentNode.replaceChild(newScript,oldScript);});var newTitle=doc.querySelector('title');if(newTitle)document.title=newTitle.textContent;if(!isPop){history.pushState({pjax:true,url:url},document.title,url);}injectJS(jsSrcs,inlineScripts).then(function(){reinitPage();hideTransition();isNavigating=false;});});}catch(e){console.warn('[PJAX] error,falling back:',e);window.location.href=url;}}else{window.location.href=url;}};xhr.onerror=xhr.ontimeout=function(){window.location.href=url;};xhr.send();}document.addEventListener('click',function(e){var a=e.target.closest?e.target.closest('a'):null;if(!a)return;if(!isLocalLink(a))return;if(a.href===window.location.href){e.preventDefault();return;}e.preventDefault();navigate(a.href,false);});window.addEventListener('popstate',function(e){if(e.state&&e.state.pjax){navigate(e.state.url||window.location.href,true);}else if(!e.state){navigate(window.location.href,true);}});history.replaceState({pjax:true,url:window.location.href},document.title,window.location.href);})();