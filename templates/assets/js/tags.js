/**
 * Theme: theme-Serenity
 * Author: Serenity
 * Build: 2026-02-18 22:58:35
 * Fingerprint: d1bb14c5cd5d10cb
 * Copyright © 2026 Serenity. All rights reserved.
 * Unauthorized copying or distribution is prohibited.
 */
document.addEventListener('DOMContentLoaded',function(){initRings();initRingTooltips();initBarChart();calcTotal();});function highlightChip(name){var chip=document.querySelector('.tag-chip[data-name="'+name+'"]');if(chip)chip.classList.add('chip-highlight');}function unhighlightChip(name){var chip=document.querySelector('.tag-chip[data-name="'+name+'"]');if(chip)chip.classList.remove('chip-highlight');}function initRings(){var rings=document.querySelectorAll('.rings-svg .ring[data-count]');if(!rings.length)return;var total=0;rings.forEach(function(r){total+=parseInt(r.dataset.count)||0;});if(total===0)total=1;rings.forEach(function(ring){var r=parseFloat(ring.getAttribute('r'));var circumference=2*Math.PI*r;var count=parseInt(ring.dataset.count)||0;var ratio=count / total;var fillRatio=Math.max(0.15,Math.min(0.85,ratio));var offset=circumference*(1-fillRatio);ring.style.strokeDasharray=circumference;ring.style.strokeDashoffset=offset;});}function calcTotal(){var el=document.getElementById('rings-total');if(!el)return;var chips=document.querySelectorAll('.tag-chip .chip-count');var total=0;if(chips.length){chips.forEach(function(c){total+=parseInt(c.textContent)||0;});}else{document.querySelectorAll('.chart-col[data-count]').forEach(function(b){total+=parseInt(b.dataset.count)||0;});}animateNumber(el,0,total,800);}function animateNumber(el,from,to,duration){var start=performance.now();function tick(now){var progress=Math.min((now-start)/ duration,1);var ease=1-Math.pow(1-progress,3);el.textContent=Math.round(from+(to-from)*ease);if(progress<1)requestAnimationFrame(tick);}requestAnimationFrame(tick);}function initRingTooltips(){var rings=document.querySelectorAll('.ring[data-name]');var tooltip=document.getElementById('ring-tooltip');if(!rings.length||!tooltip)return;rings.forEach(function(ring){ring.addEventListener('mouseenter',function(){var name=ring.dataset.name;var count=ring.dataset.count;var color=ring.dataset.color||ring.style.stroke||'#5B8FF9';tooltip.querySelector('.tooltip-dot').style.background=color;tooltip.querySelector('.tooltip-name').textContent=name;tooltip.querySelector('.tooltip-count').textContent=count+' 篇';tooltip.style.opacity='1';tooltip.style.visibility='visible';highlightChip(name);});ring.addEventListener('mouseleave',function(){tooltip.style.opacity='0';tooltip.style.visibility='hidden';unhighlightChip(ring.dataset.name);});});}function initBarChart(){var chartArea=document.getElementById('chart-area');if(!chartArea)return;var cols=Array.from(chartArea.querySelectorAll('.chart-col[data-count]'));if(!cols.length)return;cols.sort(function(a,b){return(parseInt(a.dataset.count)||0)-(parseInt(b.dataset.count)||0);});var tooltip=document.getElementById('chart-tooltip');cols.forEach(function(c){chartArea.insertBefore(c,tooltip);});var max=0;cols.forEach(function(c){var v=parseInt(c.dataset.count)||0;if(v>max)max=v;});if(max===0)return;function animate(){cols.forEach(function(c,i){var count=parseInt(c.dataset.count)||0;var pct=Math.max(8,Math.round((count / max)*100));var fill=c.querySelector('.col-fill');if(fill){fill.style.transitionDelay=(i*80)+'ms';fill.style.height=pct+'%';}});}if('IntersectionObserver' in window){var observer=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting){setTimeout(animate,200);observer.disconnect();}});},{threshold:0.2});observer.observe(chartArea);}else{setTimeout(animate,500);}if(!tooltip)return;var nameEl=tooltip.querySelector('.chart-tooltip-name');var countEl=tooltip.querySelector('.chart-tooltip-count');cols.forEach(function(col){col.addEventListener('mouseenter',function(){var name=col.dataset.name||'';var count=col.dataset.count||'0';nameEl.textContent=name;countEl.textContent=count+' 篇';var colRect=col.getBoundingClientRect();var areaRect=chartArea.getBoundingClientRect();var left=colRect.left-areaRect.left+colRect.width / 2;var fill=col.querySelector('.col-fill');var fillH=fill?fill.offsetHeight:0;var barEl=col.querySelector('.col-bar');var barH=barEl?barEl.offsetHeight:160;var top=(barH-fillH)-10;tooltip.style.left=left+'px';tooltip.style.top=top+'px';tooltip.style.opacity='1';tooltip.style.visibility='visible';highlightChip(name);});col.addEventListener('mouseleave',function(){tooltip.style.opacity='0';tooltip.style.visibility='hidden';unhighlightChip(col.dataset.name);});});}