/**
 * Theme: theme-Serenity
 * Author: Serenity
 * Build: 2026-02-04 09:13:18
 * Fingerprint: 32fea342ef53096e
 * Copyright © 2026 Serenity. All rights reserved.
 * Unauthorized copying or distribution is prohibited.
 */
(function(){const CACHE_KEY='serenity_weather_cache';const CACHE_DURATION=60*60*1000;function updateTime(){const timeEl=document.getElementById('heroTime');if(!timeEl)return;const now=new Date();const hours=String(now.getHours()).padStart(2,'0');const minutes=String(now.getMinutes()).padStart(2,'0');timeEl.textContent=`${hours}:${minutes}`;}function getCachedWeather(){try{const cached=localStorage.getItem(CACHE_KEY);if(cached){const{data,timestamp}=JSON.parse(cached);if(Date.now()-timestamp<CACHE_DURATION){return data;}}}catch(e){}return null;}function cacheWeather(data){try{localStorage.setItem(CACHE_KEY,JSON.stringify({data,timestamp:Date.now()}));}catch(e){}}function getWeatherIcon(code){const codeNum=parseInt(code);const iconMap={0:'100',1:'150',2:'100',3:'150',4:'101',5:'151',6:'102',7:'152',8:'103',9:'104',10:'104',11:'300',12:'301',13:'302',14:'302',15:'303',16:'304',17:'303',18:'304',19:'305',20:'306',21:'307',22:'308',23:'309',24:'310',25:'311',26:'400',27:'401',28:'402',29:'403',30:'404',31:'405',32:'406',33:'404',34:'405',35:'406',36:'500',37:'501',38:'502',39:'503'};const qCode=iconMap[codeNum]||'999';return `qi-${qCode}`;}function updateWeatherDisplay(data){const cityEl=document.getElementById('heroCity');const weatherEl=document.getElementById('heroWeather');const tempEl=document.getElementById('heroTemp');if(cityEl&&data.city){cityEl.textContent=data.city;}if(weatherEl&&data.text){const iconClass=getWeatherIcon(data.code);weatherEl.innerHTML=`<i class="${iconClass}"></i>${data.text}`;}if(tempEl&&data.temperature){tempEl.textContent=`${data.temperature}°C`;}}async function fetchWeather(){const config=window.WEATHER_CONFIG;if(!config||!config.apiKey){console.log('Weather:No API key configured');return;}const cached=getCachedWeather();if(cached){updateWeatherDisplay(cached);return;}try{const ipResponse=await fetch('https://api.ipify.cn/?format=json');const ipData=await ipResponse.json();if(!ipData.ip){throw new Error('IP Error');}const weatherResponse=await fetch(`https://api.seniverse.com/v3/weather/now.json?key=${config.apiKey}&location=${ipData.ip}&language=zh-Hans&unit=c`);const weatherData=await weatherResponse.json();if(!weatherData.results||!weatherData.results[0]){throw new Error('Weather API Error');}const result=weatherData.results[0];const data={temperature:result.now.temperature,text:result.now.text,code:result.now.code,city:result.location.name};cacheWeather(data);updateWeatherDisplay(data);}catch(error){console.log('Weather fetch error:',error.message);const cityEl=document.getElementById('heroCity');if(cityEl)cityEl.textContent='--';}}function init(){const config=window.WEATHER_CONFIG;if(!config)return;if(config.showTime){updateTime();setInterval(updateTime,60000);}if(config.showWeather||config.showTemperature||config.showCity){fetchWeather();}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();