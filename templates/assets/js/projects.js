/**
 * Theme: theme-Serenity
 * Author: Serenity
 * Build: 2026-02-19 12:33:02
 * Fingerprint: bd51e50c0a966e77
 * Copyright © 2026 Serenity. All rights reserved.
 * Unauthorized copying or distribution is prohibited.
 */
var GITHUB_API_BASE='https://api.github.com';var FETCH_TIMEOUT=8000;var LANGUAGE_COLORS={'JavaScript':'#f1e05a','TypeScript':'#3178c6','Python':'#3572A5','Java':'#b07219','Go':'#00ADD8','Rust':'#dea584','C++':'#f34b7d','C':'#555555','PHP':'#4F5D95','Ruby':'#701516','Swift':'#F05138','Kotlin':'#A97BFF','Vue':'#41b883','HTML':'#e34c26','CSS':'#563d7c','Shell':'#89e051','Dart':'#00B4AB'};var projectsCache=new Map();function parseGitHubUrl(url){if(typeof url !=='string')return null;const match=url.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(match)return{owner:match[1],repo:match[2].replace(/\.git$/,'')};return null;}async function fetchWithTimeout(url,options={},timeout=FETCH_TIMEOUT){const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),timeout);try{const response=await fetch(url,{...options,signal:controller.signal});clearTimeout(timeoutId);return response;}catch(error){clearTimeout(timeoutId);throw error;}}function getAuthHeaders(){const token=window.GITHUB_TOKEN;if(token)return{'Authorization':`token ${token}`};return{};}async function fetchGitHubRepo(owner,repo){try{const response=await fetchWithTimeout(`${GITHUB_API_BASE}/repos/${owner}/${repo}`,{headers:getAuthHeaders()});if(!response.ok)throw new Error('Failed to fetch');return await response.json();}catch(error){return null;}}async function fetchGitHubReleases(owner,repo){try{const response=await fetchWithTimeout(`${GITHUB_API_BASE}/repos/${owner}/${repo}/releases?per_page=20`,{headers:getAuthHeaders()});if(!response.ok)throw new Error('Failed to fetch');return await response.json();}catch(error){return [];}}function createProjectCard(data,isCustom=false,ownerType='mine'){const card=document.createElement('a');card.className='project-card';card.setAttribute('data-aos','fade-up');card.setAttribute('data-owner-type',ownerType);const languageColor=LANGUAGE_COLORS[data.language]||'#858585';let topics=[];if(isCustom&&typeof data.topics==='string'){topics=data.topics.split(',').map(t=>t.trim()).filter(t=>t).slice(0,2);}else if(Array.isArray(data.topics)){topics=data.topics.slice(0,2);}const avatarUrl=data.avatar||data.owner?.avatar_url||'';const stars=data.stars||data.stargazers_count||0;const forks=data.forks||data.forks_count||0;const projectUrl=isCustom?data.url:(data.html_url||data.url);if(ownerType==='starred'){card.href=projectUrl;card.target='_blank';card.rel='noopener noreferrer';}else{card.href='javascript:void(0)';const projectId=data.full_name||data.name;projectsCache.set(projectId,{data,isCustom,avatarUrl,projectUrl});card.onclick=(e)=>{e.preventDefault();openReleasesModal(projectId);};}const ownerBadge=ownerType==='mine'?`<div class="project-owner-badge mine" title="我的项目"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>`:`<div class="project-owner-badge starred" title="收藏项目"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div>`;card.innerHTML=`${ownerBadge}<div class="project-avatar${avatarUrl?'':' no-image'}">${avatarUrl?`<img src="${avatarUrl}" alt="${data.name}" class="project-avatar-img" />`:`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>`}</div><div class="project-info"><span class="project-name">${data.name}</span><p class="project-description">${data.description||'暂无描述'}</p><div class="project-meta">${data.language?`<div class="project-language"><span class="language-dot" style="background-color:${languageColor}"></span><span>${data.language}</span></div>`:''}<div class="project-meta-item"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg><span>${stars}</span></div><div class="project-meta-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3"/></svg><span>${forks}</span></div>${topics.length>0?`<div class="project-topics">${topics.map(t=>`<span class="project-topic">${t}</span>`).join('')}</div>`:''}</div></div><div class="project-arrow"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg></div>`;return card;}function openReleasesModal(projectId){const project=projectsCache.get(projectId);if(!project)return;const modal=document.getElementById('releasesModal');const loading=document.getElementById('releasesLoading');const empty=document.getElementById('releasesEmpty');const timeline=document.getElementById('releasesTimeline');document.getElementById('releasesAvatar').src=project.avatarUrl||'';document.getElementById('releasesProjectName').textContent=project.data.name;document.getElementById('releasesProjectDesc').textContent=project.data.description||'暂无描述';document.getElementById('releasesGithubLink').href=project.projectUrl;modal.classList.add('active');document.body.style.overflow='hidden';loading.style.display='flex';empty.style.display='none';timeline.innerHTML='';loadReleases(project);}function closeReleasesModal(){const modal=document.getElementById('releasesModal');modal.classList.remove('active');document.body.style.overflow='';}async function loadReleases(project){const loading=document.getElementById('releasesLoading');const empty=document.getElementById('releasesEmpty');const timeline=document.getElementById('releasesTimeline');const parsed=parseGitHubUrl(project.projectUrl);if(!parsed){loading.style.display='none';empty.style.display='flex';return;}const releases=await fetchGitHubReleases(parsed.owner,parsed.repo);loading.style.display='none';if(!releases||releases.length===0){empty.style.display='flex';return;}releases.forEach((release,index)=>{const item=createReleaseItem(release,index===0);timeline.appendChild(item);});}function createReleaseItem(release,isLatest){const item=document.createElement('div');item.className='release-item'+(isLatest?' latest':'');const date=new Date(release.published_at);const dateStr=date.toLocaleDateString('zh-CN',{year:'numeric',month:'short',day:'numeric'});const timeAgo=getTimeAgo(date);item.innerHTML=`<div class="release-marker"><div class="release-dot"></div><div class="release-line"></div></div><div class="release-content"><div class="release-header"><span class="release-tag">${release.tag_name}</span>${isLatest?'<span class="release-latest-badge">最新</span>':''}${release.prerelease?'<span class="release-prerelease-badge">预发布</span>':''}</div><h3 class="release-title">${release.name||release.tag_name}</h3><div class="release-meta"><span class="release-date">${dateStr}</span><span class="release-time-ago">${timeAgo}</span></div>${release.body?`<div class="release-body">${formatReleaseBody(release.body)}</div>`:''}<div class="release-actions"><a href="${release.html_url}" target="_blank" rel="noopener noreferrer" class="release-link"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>查看详情</a></div></div>`;return item;}function formatReleaseBody(body){if(!body)return '';const codeBlocks=[];let text=body.replace(/```[\s\S]*?```/g,(match)=>{codeBlocks.push(match.slice(3,-3));return `__CODE_BLOCK_${codeBlocks.length-1}__`;});const inlineCodes=[];text=text.replace(/`([^`]+)`/g,(match,code)=>{inlineCodes.push(code);return `__INLINE_CODE_${inlineCodes.length-1}__`;});text=text.replace(/\r\n/g,'\n');text=text.replace(/(#{1,4})\s+/g,'\n$1 ');const lines=text.split('\n');const result=[];let inList=false;let listType=null;for(let i=0;i<lines.length;i++){let line=lines[i].trim();if(!line){if(inList){result.push(listType==='ol'?'</ol>':'</ul>');inList=false;listType=null;}continue;}if(/^###\s+(.+)$/.test(line)){if(inList){result.push(listType==='ol'?'</ol>':'</ul>');inList=false;listType=null;}result.push(line.replace(/^###\s+(.+)$/,'<h4>$1</h4>'));continue;}if(/^##\s+(.+)$/.test(line)){if(inList){result.push(listType==='ol'?'</ol>':'</ul>');inList=false;listType=null;}result.push(line.replace(/^##\s+(.+)$/,'<h3>$1</h3>'));continue;}if(/^#\s+(.+)$/.test(line)){if(inList){result.push(listType==='ol'?'</ol>':'</ul>');inList=false;listType=null;}result.push(line.replace(/^#\s+(.+)$/,'<h2>$1</h2>'));continue;}if(/^[\*\-]\s+(.+)$/.test(line)){if(!inList||listType !=='ul'){if(inList)result.push(listType==='ol'?'</ol>':'</ul>');result.push('<ul>');inList=true;listType='ul';}result.push(line.replace(/^[\*\-]\s+(.+)$/,'<li>$1</li>'));continue;}if(/^\d+\.\s+(.+)$/.test(line)){if(!inList||listType !=='ol'){if(inList)result.push(listType==='ol'?'</ol>':'</ul>');result.push('<ol>');inList=true;listType='ol';}result.push(line.replace(/^\d+\.\s+(.+)$/,'<li>$1</li>'));continue;}if(inList){result.push(listType==='ol'?'</ol>':'</ul>');inList=false;listType=null;}result.push(`<p>${line}</p>`);}if(inList)result.push(listType==='ol'?'</ol>':'</ul>');let html=result.join('');html=html.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');html=html.replace(/\*(.+?)\*/g,'<em>$1</em>');html=html.replace(/__(.+?)__/g,'<strong>$1</strong>');html=html.replace(/_([^_]+)_/g,'<em>$1</em>');html=html.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');inlineCodes.forEach((code,i)=>{html=html.replace(`__INLINE_CODE_${i}__`,`<code>${code}</code>`);});codeBlocks.forEach((code,i)=>{const lang=code.split('\n')[0];const content=lang?code.slice(lang.length+1):code;html=html.replace(`__CODE_BLOCK_${i}__`,`<pre><code>${content}</code></pre>`);});return html;}function getTimeAgo(date){const now=new Date();const diff=now-date;const days=Math.floor(diff /(1000*60*60*24));if(days===0)return '今天';if(days===1)return '昨天';if(days<7)return `${days}天前`;if(days<30)return `${Math.floor(days / 7)}周前`;if(days<365)return `${Math.floor(days / 30)}个月前`;return `${Math.floor(days / 365)}年前`;}document.addEventListener('keydown',(e)=>{if(e.key==='Escape')closeReleasesModal();});async function loadProjects(){const grid=document.getElementById('projectsGrid');const loading=document.getElementById('projectsLoading');const empty=document.getElementById('projectsEmpty');const GITHUB_PROJECTS=window.GITHUB_PROJECTS||[];const CUSTOM_PROJECTS=window.CUSTOM_PROJECTS||[];if((!GITHUB_PROJECTS||GITHUB_PROJECTS.length===0)&&(!CUSTOM_PROJECTS||CUSTOM_PROJECTS.length===0)){loading.style.display='none';empty.style.display='flex';return;}const projects=[];let totalStars=0,totalForks=0,mineCount=0,starredCount=0;for(const item of GITHUB_PROJECTS){const url=typeof item==='string'?item:item.url;const ownerType=typeof item==='string'?'mine':(item.ownerType||'mine');const parsed=parseGitHubUrl(url);if(!parsed)continue;const data=await fetchGitHubRepo(parsed.owner,parsed.repo);if(data){projects.push({data,isCustom:false,ownerType});totalStars+=parseInt(data.stargazers_count)||0;totalForks+=parseInt(data.forks_count)||0;if(ownerType==='mine')mineCount++;else starredCount++;}}for(const customProject of CUSTOM_PROJECTS){const ownerType=customProject.ownerType||'mine';projects.push({data:customProject,isCustom:true,ownerType});totalStars+=parseInt(customProject.stars)||0;totalForks+=parseInt(customProject.forks)||0;if(ownerType==='mine')mineCount++;else starredCount++;}loading.style.display='none';if(projects.length===0){empty.style.display='flex';return;}const fmt=n=>n>=1000?n.toLocaleString('en-US'):n.toString();document.getElementById('totalProjects').textContent=projects.length;document.getElementById('mineProjects').textContent=mineCount;document.getElementById('starredProjects').textContent=starredCount;document.getElementById('totalStars').textContent=fmt(totalStars);document.getElementById('totalForks').textContent=fmt(totalForks);projects.forEach((p,i)=>{const card=createProjectCard(p.data,p.isCustom,p.ownerType);card.setAttribute('data-aos-delay',(i*50).toString());grid.appendChild(card);});}document.addEventListener('DOMContentLoaded',loadProjects);